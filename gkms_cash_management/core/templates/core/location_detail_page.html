{% extends 'core/base.html' %}

{% block title %}{{ title }}{% endblock %}

{% block extra_css %}
<style>
    .detail-card {
        border-radius: .5rem;
        box-shadow: 0 2px 10px rgba(0,0,0,0.07);
    }
    .page-header {
        background: linear-gradient(135deg, #e53935, #c62828);
        color: white;
        padding: 2rem;
        margin-bottom: 2rem;
        border-radius: .5rem;
    }
    .list-group-item {
        border-left: 0;
        border-right: 0;
    }
    .list-group-item:first-child {
        border-top-left-radius: 0;
        border-top-right-radius: 0;
        border-top: 0;
    }
    .list-group-item:last-child {
        border-bottom-left-radius: 0;
        border-bottom-right-radius: 0;
        border-bottom: 0;
    }
    .label {
        color: #6c757d;
        font-weight: 500;
    }
    .form-label {
        font-weight: 500;
    }
    .eft-data-section th {
        width: 30%;
        background-color: #f8f9fa;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="page-header">
        <div class="d-flex justify-content-between align-items-center">
            <h1 class="display-5 mb-0"><i class="{{ icon|default:'fas fa-building' }} me-2"></i> {{ location.name }}</h1>
            <a href="{% url 'manage_locations' %}" class="btn btn-light btn-sm">
                <i class="fas fa-arrow-left me-1"></i> Back to All Locations
            </a>
        </div>
        <p class="lead mt-2">View and edit detailed information for this location.</p>
    </div>

    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        {% endfor %}
    {% endif %}

    <div class="row">
        <div class="col-lg-7 mb-4">
            <div class="card detail-card">
                <div class="card-header bg-danger text-white">
                    <h5 class="mb-0"><i class="fas fa-edit me-2"></i>Edit Location Information</h5>
                </div>
                <div class="card-body p-4">
                    <form method="post">
                        {% csrf_token %}
                        <div class="mb-3">
                            <label for="id_name" class="form-label">Location Name</label>
                            {{ form.name }}
                        </div>
                        <div class="mb-3">
                            <label for="id_address" class="form-label">Address</label>
                            {{ form.address }}
                        </div>
                        <div class="mb-3">
                            <label for="id_eft_system_name" class="form-label">EFT System Name</label>
                            {{ form.eft_system_name }}
                        </div>
                        <div class="mb-3">
                            <label for="id_remote_services_name" class="form-label">Remote Services Name</label>
                            {{ form.remote_services_name }}
                        </div>
                        <div class="mb-3">
                            <label for="id_insurance_limit_name" class="form-label">Insurance Limit Name</label>
                            {{ form.insurance_limit_name }}
                        </div>
                        <div class="d-grid">
                            <button type="submit" class="btn btn-danger"><i class="fas fa-save me-2"></i>Save Changes</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-lg-5 mb-4">
            <div class="card detail-card">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>Current Location Details</h5>
                </div>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item"><strong>Name:</strong> {{ location.name }}</li>
                    <li class="list-group-item"><strong>Address:</strong> {{ location.address|linebreaksbr }}</li>
                    <li class="list-group-item"><strong>EFT System Name:</strong> {{ location.eft_system_name }}</li>
                    <li class="list-group-item"><strong>Remote Services Name:</strong> {{ location.remote_services_name }}</li>
                    <li class="list-group-item"><strong>Insurance Limit Name:</strong> {{ location.insurance_limit_name }}</li>
                </ul>
            </div>

            {% if latest_eft_data %}
            <div class="card detail-card mt-4">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="fas fa-file-invoice-dollar me-2"></i>EFT Information</h5>
                </div>
                <div class="card-body">
                    <p>
                        <button class="btn btn-success w-100" type="button" data-bs-toggle="collapse" data-bs-target="#eftDataCollapse" aria-expanded="false" aria-controls="eftDataCollapse">
                            <i class="fas fa-eye me-2"></i> View Latest EFT Data ({{ latest_eft_data.statement_date|date:"Y-m-d" }})
                        </button>
                    </p>
                    <div class="collapse" id="eftDataCollapse">
                        <div class="table-responsive eft-data-section">
                            <table class="table table-bordered table-sm">
                                <tbody>
                                    <tr><th>Statement Date</th><td>{{ latest_eft_data.statement_date|date:"Y-m-d" }}</td></tr>
                                    <tr><th>Balance B/F</th><td>${{ latest_eft_data.balance_bf|floatformat:2 }}</td></tr>
                                    <tr><th>Inbound</th><td>${{ latest_eft_data.inbound|floatformat:2 }}</td></tr>
                                    <tr><th>Intra-Sent</th><td>${{ latest_eft_data.intra_sent|floatformat:2 }}</td></tr>
                                    <tr><th>Outbound</th><td>${{ latest_eft_data.outbound|floatformat:2 }}</td></tr>
                                    <tr><th>Loan</th><td>${{ latest_eft_data.loan|floatformat:2 }}</td></tr>
                                    <tr><th>Rec'd Fr. GK</th><td>${{ latest_eft_data.received_from_gk|floatformat:2 }}</td></tr>
                                    <tr><th>Adjusted</th><td>${{ latest_eft_data.adjusted|floatformat:2 }}</td></tr>
                                    <tr><th>BX</th><td>${{ latest_eft_data.bx|floatformat:2 }}</td></tr>
                                    <tr><th>SC</th><td>${{ latest_eft_data.sc|floatformat:2 }}</td></tr>
                                    <tr><th>FX</th><td>${{ latest_eft_data.fx|floatformat:2 }}</td></tr>
                                    <tr><th>Due To GK</th><td>${{ latest_eft_data.due_to_gk|floatformat:2 }}</td></tr>
                                    <tr><th>Due From GK</th><td>${{ latest_eft_data.due_from_gk|floatformat:2 }}</td></tr>
                                    <tr><th>Uploaded At</th><td>{{ latest_eft_data.uploaded_at|date:"Y-m-d H:i" }}</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            {% else %}
            <div class="alert alert-info mt-4" role="alert">
                <i class="fas fa-info-circle me-2"></i> No EFT data found for this location.
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %} 